====== Info for node: <%= @n.name %> ======

<%  # defaults
    @ipaddress = @n.has_key?('ipaddress')? @n['ipaddress'] : "unknown"
    @macaddress = @n.has_key?('macaddress')? @n['macaddress'] : "unknown"
-%>

**DO NOT EDIT THIS PAGE. It is generated by modularit-inventory chef cookbook. Any changes will be overwriten on next run**

For manual documentation check [[<%= @n.name %>]]

==== General ====

^ Hostname | <%= @n.name %> |
^ OS | <%= @n.platform %> <%= @n.platform_version %> |
^ IP address | <%= @ipaddress %> |
^ MAC address | <%= @macaddress %> |

===== Hardware info =====

<%  # defaults
    @manufacturer = (@n.has_key?('dmi') && @n['dmi'].has_key?('system') && @n['dmi']['system'].has_key?('manufacturer')) ? @n['dmi']['system']['manufacturer'] : "Unknown"
    @product_name = (@n.has_key?('dmi') && @n['dmi'].has_key?('system') && @n['dmi']['system'].has_key?('product_name')) ? @n['dmi']['system']['product_name'] : "Unknown"
    @serial_number = (@n.has_key?('dmi') && @n['dmi'].has_key?('system') && @n['dmi']['system'].has_key?('serial_number')) ? @n['dmi']['system']['serial_number'] : "Unknown"
    @memory = (@n.has_key?('memory') && @n['memory'].has_key?('total')) ? @n['memory']['total'] : "unknown"
    @cpu_num = (@n.has_key?('cpu') && @n['cpu'].has_key?('total')) ? @n['cpu']['total'] : "unknown"
-%>

^ Manufacturer | <%= @manufacturer %> |
^ Product Name | <%= @product_name %> |
^ Serial Number | <%= @serial_number %> |
^ Memory | <%= @memory %> |
^ CPU | <%= @cpu_num %> |

<% if @n.has_key?('virtualization') && @n['virtualization'].has_key?('system') -%>

===== Virtualization =====

^ System | <%= @n['virtualization']['system'] %> |
^ Type | <%= @n['virtualization']['role'] %> |
<%   if @n['virtualization'].has_key?('guest_list') -%>
<% # Very UGLY hack that assumes a name like admindomain.vmname -%>
^ Guests | <%= @n['virtualization']['guest_list'].keys.map{ |vm| 
  prefix=vm.include?(".") ? "#{vm.split(".")[0]}:" : "#{@n['modularit']['admindomain']}.";
  "[[#{prefix}#{vm}_chef|#{vm}]]"}.join(", ") %> |
<%   end -%>
<% end -%>

<% if @n.has_key?('rasca_status') -%>

===== Rasca =====

^ Alert ^ Status ^ Last Update ^ Last Change ^ Last Message ^
<% @n['rasca_status'].keys.sort.each do |alarm| 
    @n['rasca_status'][alarm].keys.each do |entry|
     next if entry.match(/^Notify/)
     @last_status=@n['rasca_status'][alarm][entry].has_key?('last_status') ? @n['rasca_status'][alarm][entry]['last_status'] : "Unknown"
     @last_status="**#{@last_status}**" if @last_status != "OK"
     @last_change=@n['rasca_status'][alarm][entry].has_key?('status_last_change') ? @n['rasca_status'][alarm][entry]['status_last_change'] : "Unknown"
     @last_updated=@n['rasca_status'][alarm][entry].has_key?('ctime') ? @n['rasca_status'][alarm][entry]['ctime'] : "Unknown"
     @last_message=@n['rasca_status'][alarm][entry].has_key?('short') ? @n['rasca_status'][alarm][entry]['short'] : "Unknown"
-%>
| <%= alarm %> | <%= @last_status%> | <%= @last_updated%> | <%= @last_change %> | <%= @last_message %> |
<%  end -%>
<% end -%>

<% end %>

===== Network interfaces =====

^ Interface ^ Address ^ Family ^
<% @n['network']['interfaces'].keys.each do |int|
    if @n['network']['interfaces'][int].has_key?('addresses')
     @n['network']['interfaces'][int]['addresses'].keys.each do |addr| 
-%>
| <%= int %> | <%= addr  %> | <%= @n['network']['interfaces'][int]['addresses'][addr]['family'] %> | 
<%   end -%>
<%  end -%>
<% end -%>

<%
#**TODO**
#
#  * IPMI
#  * Nagios
#  * Backups
-%>
